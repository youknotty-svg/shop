<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fresh Market</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <style>
        :root {
            --bg: #000000;
            --card-bg: #1c1c1e;
            --item-bg: #000000;
            --text: #ffffff;
            --text-sec: #8e8e93;
            --accent: #0a84ff;
            --border: #38383a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            padding-bottom: 80px; /* –£–º–µ–Ω—å—à–∏–ª –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            -webkit-font-smoothing: antialiased;
        }

        /* HEADER */
        .header {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 10px 16px;
        }

        .search-wrap { position: relative; width: 100%; }
        .search-input {
            width: 100%; padding: 8px 36px 8px 32px; /* –ë–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–æ–∏—Å–∫ */
            border-radius: 10px; border: none;
            background: #2c2c2e; color: #fff; font-size: 15px;
        }
        .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); opacity: 0.5; font-size: 14px; }

        /* CONTAINER */
        .container { padding: 12px 12px; }

        /* CATEGORY CARD */
        .cat-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px; /* –£–í–ï–õ–ò–ß–ï–ù–ù–´–ô –û–¢–°–¢–£–ü –ú–ï–ñ–î–£ –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò */
        }

        .cat-header {
            padding: 14px 16px; /* –ú–µ–Ω—å—à–µ –ø–∞–¥–¥–∏–Ω–≥–∏ */
            display: flex; align-items: center; justify-content: space-between;
            font-size: 17px; font-weight: 600;
            cursor: pointer;
            background: var(--card-bg);
            border-bottom: 1px solid transparent; /* –î–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ –≥—Ä–∞–Ω–∏—Ü */
        }
        .cat-header:active { background: #2c2c2e; }
        .cat-icon { font-size: 20px; margin-right: 10px; }
        .arrow { 
            font-size: 12px; color: var(--text-sec); 
            transition: transform 0.3s ease; 
        }
        .cat-header.expanded .arrow { transform: rotate(180deg); }
        .cat-header.expanded { border-bottom: 1px solid var(--border); }

        /* ACCORDION ANIMATION */
        .sub-container { 
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out; /* –ü–õ–ê–í–ù–ê–Ø –ê–ù–ò–ú–ê–¶–ò–Ø */
            background: var(--bg);
        }
        .sub-container.visible {
            max-height: 2000px; /* –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è */
        }

        /* SUB-CATEGORY */
        .sub-header {
            padding: 10px 16px 10px 24px;
            font-size: 14px; font-weight: 500; color: #fff;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer;
            background: #121212;
            border-bottom: 1px solid #222;
        }
        .sub-arrow { font-size: 10px; color: var(--text-sec); transition: transform 0.3s; }
        .sub-header.expanded .sub-arrow { transform: rotate(180deg); }

        /* SUB-LIST ANIMATION */
        .item-list-wrap {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
            background: #000;
        }
        .item-list-wrap.visible {
            max-height: 1500px;
        }

        /* ITEM ROW - COMPACT */
        .item-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 16px; /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
            border-bottom: 1px solid #222;
            min-height: 44px;
        }
        .item-row:last-child { border-bottom: none; }

        .item-name { font-size: 15px; font-weight: 400; color: #fff; flex: 1; padding-right: 10px; }

        /* CONTROLS - COMPACT & CLEAN */
        .btn-add {
            background: rgba(10, 132, 255, 0.15);
            color: var(--accent);
            border: none;
            padding: 4px 12px; /* –ú–∞–ª–µ–Ω—å–∫–∞—è –∫–Ω–æ–ø–∫–∞ */
            border-radius: 8px;
            font-weight: 500; font-size: 13px;
            cursor: pointer;
        }

        .counter-wrap {
            display: flex; align-items: center; gap: 4px;
            background: #2c2c2e; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ */
            border-radius: 8px;
            padding: 2px;
        }

        .btn-mini {
            width: 28px; height: 28px; /* –ú–∞–ª–µ–Ω—å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ +/- */
            border-radius: 6px; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; font-weight: 500;
            cursor: pointer; background: transparent; color: var(--accent);
        }
        .btn-mini:active { background: rgba(255,255,255,0.1); }
        .btn-mini.minus { color: #ff453a; }

        .val-display {
            min-width: 30px; text-align: center;
            font-size: 14px; font-weight: 600; color: #fff;
            cursor: pointer;
        }

        .btn-comment {
            font-size: 16px; background: transparent; border: none; 
            padding: 4px; opacity: 0.3; margin-right: 4px; filter: grayscale(1);
        }
        .btn-comment.active { opacity: 1; filter: none; }

        /* CART BAR */
        .cart-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #1c1c1e;
            border-top: 1px solid var(--border);
            padding: 10px 16px;
            display: flex; align-items: center; justify-content: space-between;
            transform: translateY(100%); transition: transform 0.3s;
            z-index: 900;
        }
        .cart-bar.visible { transform: translateY(0); }
        .cart-info { font-size: 14px; font-weight: 600; color: #fff; }
        .btn-checkout {
            background: var(--accent); color: #fff; border: none;
            padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 600;
        }

        /* MODALS */
        .modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7); z-index: 2000;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(2px);
        }
        .modal.visible { display: flex; }
        .modal-box {
            background: #1c1c1e; width: 85%; max-width: 320px;
            border-radius: 14px; padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .sys-input {
            width: 100%; background: #000; border: 1px solid #333;
            color: #fff; font-size: 24px; font-weight: 700;
            text-align: center; margin: 15px 0; padding: 10px; border-radius: 8px;
        }
        .modal-btns { display: flex; gap: 10px; margin-top: 15px; }
        .btn-mod { flex: 1; padding: 10px; border-radius: 8px; border: none; font-size: 14px; font-weight: 500; cursor: pointer; }
        .btn-grey { background: #333; color: #fff; }
        .btn-blue { background: var(--accent); color: #fff; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="header">
        <div class="search-wrap">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" id="search" placeholder="–ü–æ–∏—Å–∫...">
        </div>
    </div>

    <div class="container">
        <div id="searchResults" class="hidden"></div>
        <div id="accordionView"></div>
    </div>

    <!-- Cart Bar -->
    <div class="cart-bar" id="cartBar">
        <div class="cart-info" id="cartCount">0 –ø–æ–∑.</div>
        <button class="btn-checkout" onclick="openOrderModal()">–í –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>

    <!-- Input Modal -->
    <div class="modal" id="inputModal">
        <div class="modal-box">
            <div id="inputName" style="color: #8e8e93; font-size: 14px; margin-bottom: 5px;"></div>
            <input type="number" id="sysInput" class="sys-input" inputmode="decimal" placeholder="0">
            <div class="modal-btns">
                <button class="btn-mod btn-grey" onclick="closeModal('inputModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-mod btn-blue" onclick="saveInput()">–û–ö</button>
            </div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div class="modal" id="commentModal">
        <div class="modal-box">
            <div style="margin-bottom:10px; font-weight:600;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>
            <textarea id="comText" style="width:100%; height:80px; background:#000; border:1px solid #333; color:#fff; border-radius:8px; padding:10px; font-size:14px; resize:none;"></textarea>
            <div class="modal-btns">
                <button class="btn-mod btn-grey" onclick="closeModal('commentModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-mod btn-blue" onclick="saveComment()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div class="modal" id="orderModal">
        <div class="modal-box" style="width:95%; max-width:400px; text-align:left;">
            <div style="font-size:18px; font-weight:700; margin-bottom:15px; text-align:center;">–í–∞—à –∑–∞–∫–∞–∑</div>
            <div id="orderList" style="max-height:50vh; overflow-y:auto; margin-bottom:15px; border-top:1px solid #333;"></div>
            <textarea id="globalCom" style="width:100%; height:60px; background:#000; border:1px solid #333; color:#fff; border-radius:8px; padding:10px; font-size:14px; margin-bottom:15px;" placeholder="–û–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
            <div class="modal-btns">
                <button class="btn-mod btn-grey" onclick="closeModal('orderModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="btn-mod btn-blue" onclick="sendOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.setHeaderColor('#1c1c1e');
    tg.setBackgroundColor('#000000');

    // DATA
    const DB = {
        "veg": { "name": "–û–≤–æ—â–∏", "icon": "ü•¶", "subs": {
            "roots": { "name": "–ö–æ—Ä–Ω–µ–ø–ª–æ–¥—ã", "items": [
                { "id": "galan", "name": "–ì–∞–ª–∞–Ω–≥–∞–ª –∫–æ—Ä–µ–Ω—å", "u": "–∫–≥" },
                { "id": "daik", "name": "–î–∞–π–∫–æ–Ω", "u": "–∫–≥" },
                { "id": "imbir", "name": "–ò–º–±–∏—Ä—å –∫–æ—Ä–µ–Ω—å", "u": "–∫–≥" },
                { "id": "mor_yel", "name": "–ú–æ—Ä–∫–æ–≤—å –∂–µ–ª—Ç–∞—è", "u": "–∫–≥" },
                { "id": "mor_myt", "name": "–ú–æ—Ä–∫–æ–≤—å –º—ã—Ç–∞—è", "u": "–∫–≥" },
                { "id": "mor_ros", "name": "–ú–æ—Ä–∫–æ–≤—å –†–æ—Å—Å–∏—è", "u": "–∫–≥" },
                { "id": "mor_bot", "name": "–ú–æ—Ä–∫–æ–≤—å —Å –±–æ—Ç–≤–æ–π", "u": "–∫–≥" },
                { "id": "past", "name": "–ü–∞—Å—Ç–µ—Ä–Ω–∞–∫", "u": "–∫–≥" },
                { "id": "rad_red", "name": "–†–µ–¥–∏—Å –∫—Ä–∞—Å–Ω—ã–π", "u": "–∫–≥" },
                { "id": "red_arb", "name": "–†–µ–¥—å–∫–∞ –∞—Ä–±—É–∑–Ω–∞—è", "u": "–∫–≥" },
                { "id": "rad_bot", "name": "–†–µ–¥–∏—Å —Å –±–æ—Ç–≤–æ–π", "u": "–∫–≥" },
                { "id": "repa", "name": "–†–µ–ø–∞", "u": "–∫–≥" },
                { "id": "svek", "name": "–°–≤–µ–∫–ª–∞", "u": "–∫–≥" },
                { "id": "seld_kor", "name": "–ö–æ—Ä–µ–Ω—å —Å–µ–ª—å–¥–µ—Ä–µ—è", "u": "–∫–≥" },
                { "id": "topin", "name": "–¢–æ–ø–∏–Ω–∞–º–±—É—Ä", "u": "–∫–≥" },
                { "id": "hren", "name": "–•—Ä–µ–Ω –∫–æ—Ä–µ–Ω—å", "u": "–∫–≥" }
            ]},
            "tomatoes": { "name": "–¢–æ–º–∞—Ç—ã", "items": [
                { "id": "tom_kra", "name": "–¢–æ–º–∞—Ç –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "u": "–∫–≥" },
                { "id": "tom_yel", "name": "–¢–æ–º–∞—Ç –∂–µ–ª—Ç—ã–π", "u": "–∫–≥" },
                { "id": "tom_slv", "name": "–¢–æ–º–∞—Ç –∫—Ä–∞—Å–Ω—ã–π —Å–ª–∏–≤–∫–∞", "u": "–∫–≥" },
                { "id": "tom_gri", "name": "–¢–æ–º–∞—Ç –ì—Ä–∏–ª—å", "u": "–∫–≥" },
                { "id": "tom_uzb_l", "name": "–¢–æ–º–∞—Ç –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω (–õ—é–∫—Å)", "u": "–∫–≥" },
                { "id": "tom_uzb", "name": "–¢–æ–º–∞—Ç –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", "u": "–∫–≥" },
                { "id": "tom_aze", "name": "–¢–æ–º–∞—Ç –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω", "u": "–∫–≥" },
                { "id": "tom_dag", "name": "–¢–æ–º–∞—Ç –î–∞–≥–µ—Å—Ç–∞–Ω", "u": "–∫–≥" },
                { "id": "tom_che_y", "name": "–ß–µ—Ä—Ä–∏ –∂–µ–ª—Ç—ã–µ", "u": "–∫–≥" },
                { "id": "tom_che_r", "name": "–ß–µ—Ä—Ä–∏ –∫—Ä–∞—Å–Ω—ã–µ", "u": "–∫–≥" },
                { "id": "tom_che_k", "name": "–ß–µ—Ä—Ä–∏ –∫—É–º–∞—Ç–æ", "u": "–∫–≥" },
                { "id": "tom_che_m", "name": "–ß–µ—Ä—Ä–∏ –º–µ–¥–æ–≤—ã–µ", "u": "–∫–≥" },
                { "id": "tom_che_s", "name": "–ß–µ—Ä—Ä–∏ –º–∏–Ω–∏ —Å–ª–∏–≤–∫–∞", "u": "–∫–≥" },
                { "id": "tom_che_v", "name": "–ß–µ—Ä—Ä–∏ –Ω–∞ –≤–µ—Ç–∫–µ", "u": "–∫–≥" },
                { "id": "tom_che_mix", "name": "–ß–µ—Ä—Ä–∏ –ú–∏–∫—Å", "u": "–∫–≥" },
                { "id": "tom_kum", "name": "–¢–æ–º–∞—Ç –∫—É–º–∞—Ç–æ", "u": "–∫–≥" },
                { "id": "tom_ban", "name": "–¢–æ–º–∞—Ç –ë–∞–Ω—á", "u": "–∫–≥" }
            ]},
            "cucumbers": { "name": "–û–≥—É—Ä—Ü—ã", "items": [
                { "id": "cuc_bak", "name": "–û–≥—É—Ä—Ü—ã –±–∞–∫–∏–Ω—Å–∫–∏–µ", "u": "–∫–≥" },
                { "id": "cuc_lng", "name": "–û–≥—É—Ä–µ—Ü –¥–ª–∏–Ω–Ω–æ–ø–ª–æ–¥–Ω—ã–π", "u": "–∫–≥" },
                { "id": "cuc_kur", "name": "–û–≥—É—Ä—Ü—ã –ö—É—Ä–∞–∂", "u": "–∫–≥" },
                { "id": "cuc_lux", "name": "–û–≥—É—Ä—Ü—ã –õ—é–∫—Å/–ú–∏—Ä–∏–Ω–¥–∞", "u": "–∫–≥" }
            ]},
            "potatoes": { "name": "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å", "items": [
                { "id": "pot_bat", "name": "–ë–∞—Ç–∞—Ç", "u": "–∫–≥" },
                { "id": "pot_bab", "name": "–ë—ç–±–∏", "u": "–∫–≥" },
                { "id": "pot_bab_s", "name": "–ë—ç–±–∏ —Å–∏–Ω–µ–≥–ª–∞–∑–∫–∞", "u": "–∫–≥" },
                { "id": "pot_gal", "name": "–ì–∞–ª–∞", "u": "–∫–≥" },
                { "id": "pot_gri", "name": "–ì—Ä–∏–ª—å", "u": "–∫–≥" },
                { "id": "pot_red_d", "name": "–ö—Ä–∞—Å–Ω—ã–π (–≥—Ä—è–∑–Ω—ã–π)", "u": "–∫–≥" },
                { "id": "pot_red_m", "name": "–ö—Ä–∞—Å–Ω—ã–π (–º—ã—Ç—ã–π)", "u": "–∫–≥" },
                { "id": "pot_myt", "name": "–ú—ã—Ç—ã–π", "u": "–∫–≥" }
            ]},
            "cabbage": { "name": "–ö–∞–ø—É—Å—Ç–∞", "items": [
                { "id": "cab_bk", "name": "–ö–∞–ø—É—Å—Ç–∞ –±/–∫", "u": "–∫–≥" },
                { "id": "cab_bro", "name": "–ë—Ä–æ–∫–∫–æ–ª–∏", "u": "–∫–≥" },
                { "id": "cab_bro_cal", "name": "–ë—Ä–æ–∫–∫–æ–ª–∏ (–∫–∞–ª–∏–±—Ä)", "u": "–∫–≥" },
                { "id": "cab_bru", "name": "–ë—Ä—é—Å—Å–µ–ª—å—Å–∫–∞—è", "u": "–∫–≥" },
                { "id": "cab_kol", "name": "–ö–æ–ª—å—Ä–∞–±–∏", "u": "–∫–≥" },
                { "id": "cab_red", "name": "–ö—Ä–∞—Å–Ω–æ–∫–æ—á–∞–Ω–Ω–∞—è", "u": "–∫–≥" },
                { "id": "cab_mol", "name": "–ú–æ–ª–æ–¥–∞—è", "u": "–∫–≥" },
                { "id": "cab_mol_s", "name": "–ú–æ–ª–æ–¥–∞—è —Å–∞–ª–∞—Ç–Ω–∞—è", "u": "–∫–≥" },
                { "id": "cab_pek", "name": "–ü–µ–∫–∏–Ω—Å–∫–∞—è", "u": "–∫–≥" },
                { "id": "cab_sav", "name": "–°–∞–≤–æ–π—Å–∫–∞—è", "u": "–∫–≥" },
                { "id": "cab_col", "name": "–¶–≤–µ—Ç–Ω–∞—è", "u": "–∫–≥" },
                { "id": "cab_col_cal", "name": "–¶–≤–µ—Ç–Ω–∞—è (–∫–∞–ª–∏–±—Ä)", "u": "–∫–≥" },
                { "id": "kale", "name": "–ö–µ–π–ª", "u": "–∫–≥" }
            ]},
            "onions": { "name": "–õ—É–∫ –∏ –ß–µ—Å–Ω–æ–∫", "items": [
                { "id": "luk_wh", "name": "–õ—É–∫ –±–µ–ª—ã–π", "u": "–∫–≥" },
                { "id": "luk_gr_kor", "name": "–õ—É–∫ –∑–µ–ª–µ–Ω—ã–π (—Å –∫–æ—Ä–Ω–µ–º)", "u": "–∫–≥" },
                { "id": "luk_gr", "name": "–õ—É–∫ –∑–µ–ª–µ–Ω—ã–π", "u": "–∫–≥" },
                { "id": "luk_red", "name": "–õ—É–∫ –∫—Ä–∞—Å–Ω—ã–π", "u": "–∫–≥" },
                { "id": "luk_yal", "name": "–õ—É–∫ –∫—Ä—ã–º—Å–∫–∏–π", "u": "–∫–≥" },
                { "id": "luk_por", "name": "–õ—É–∫ –ø–æ—Ä–µ–π", "u": "–∫–≥" },
                { "id": "luk_rep", "name": "–õ—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π", "u": "–∫–≥" },
                { "id": "luk_rep_big", "name": "–õ—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π –∫—Ä—É–ø–Ω—ã–π", "u": "–∫–≥" },
                { "id": "luk_sib", "name": "–õ—É–∫ —Å–∏–±—É–ª–µ—Ç", "u": "–∫–≥" },
                { "id": "luk_sha", "name": "–õ—É–∫ —à–∞–ª–æ—Ç", "u": "–∫–≥" },
                { "id": "ches", "name": "–ß–µ—Å–Ω–æ–∫", "u": "–∫–≥" },
                { "id": "ches_mol", "name": "–ß–µ—Å–Ω–æ–∫ –º–æ–ª–æ–¥–æ–π", "u": "–∫–≥" }
            ]},
            "peppers": { "name": "–ü–µ—Ä—Ü—ã", "items": [
                { "id": "pep_yel", "name": "–ü–µ—Ä–µ—Ü –±–æ–ª–≥–∞—Ä—Å–∫–∏–π –∂–µ–ª—Ç—ã–π", "u": "–∫–≥" },
                { "id": "pep_grn", "name": "–ü–µ—Ä–µ—Ü –±–æ–ª–≥–∞—Ä—Å–∫–∏–π –∑–µ–ª–µ–Ω—ã–π", "u": "–∫–≥" },
                { "id": "pep_red", "name": "–ü–µ—Ä–µ—Ü –±–æ–ª–≥–∞—Ä—Å–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π", "u": "–∫–≥" },
                { "id": "pep_gr_red", "name": "–ü–µ—Ä–µ—Ü –≥—Ä—É–Ω—Ç –∫—Ä–∞—Å–Ω—ã–π", "u": "–∫–≥" },
                { "id": "pep_ram", "name": "–ü–µ—Ä–µ—Ü –†–∞–º–∏—Ä–æ", "u": "–∫–≥" },
                { "id": "chil_gr_arm", "name": "–ß–∏–ª–∏ –∑–µ–ª–µ–Ω—ã–π (–ê—Ä–º)", "u": "–∫–≥" },
                { "id": "chil_gr", "name": "–ß–∏–ª–∏ –∑–µ–ª–µ–Ω—ã–π", "u": "–∫–≥" },
                { "id": "chil_rd", "name": "–ß–∏–ª–∏ –∫—Ä–∞—Å–Ω—ã–π", "u": "–∫–≥" },
                { "id": "chil_thai", "name": "–ß–∏–ª–∏ –¢–∞–π—Å–∫–∏–π (80–≥)", "u": "—É–ø" }
            ]},
            "other": { "name": "–î—Ä—É–≥–∏–µ –æ–≤–æ—â–∏", "items": [
                { "id": "art_gr", "name": "–ê—Ä—Ç–∏—à–æ–∫–∏ –∑–µ–ª–µ–Ω—ã–µ", "u": "–∫–≥" },
                { "id": "art_vi", "name": "–ê—Ä—Ç–∏—à–æ–∫–∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–µ", "u": "–∫–≥" },
                { "id": "bakl", "name": "–ë–∞–∫–ª–∞–∂–∞–Ω", "u": "–∫–≥" },
                { "id": "bakl_gr", "name": "–ë–∞–∫–ª–∞–∂–∞–Ω –≥—Ä—É–Ω—Ç–æ–≤–æ–π", "u": "–∫–≥" },
                { "id": "goroh", "name": "–ì–æ—Ä–æ—Ö —Å—Ç—Ä—É—á–∫–æ–≤—ã–π (–ö–µ–Ω–∏—è)", "u": "–∫–≥" },
                { "id": "kab_wh", "name": "–ö–∞–±–∞—á–æ–∫ –±–µ–ª—ã–π", "u": "–∫–≥" },
                { "id": "kuk", "name": "–ö—É–∫—É—Ä—É–∑–∞ —Å–≤–µ–∂–∞—è", "u": "–∫–≥" },
                { "id": "seld_st", "name": "–°—Ç–µ–±–µ–ª—å —Å–µ–ª—å–¥–µ—Ä–µ—è", "u": "–∫–≥" },
                { "id": "spar", "name": "–°–ø–∞—Ä–∂–∞ –∑–µ–ª–µ–Ω–∞—è", "u": "–∫–≥" },
                { "id": "tyk_bat", "name": "–¢—ã–∫–≤–∞ –ë–∞—Ç—Ç–µ—Ä–Ω–∞—Ç", "u": "–∫–≥" },
                { "id": "tyk_rou", "name": "–¢—ã–∫–≤–∞ –∫—Ä—É–≥–ª–∞—è", "u": "–∫–≥" },
                { "id": "fasol", "name": "–§–∞—Å–æ–ª—å —Å—Ç—Ä—É—á–∫–æ–≤–∞—è", "u": "–∫–≥" },
                { "id": "fenhel", "name": "–§–µ–Ω—Ö–µ–ª—å", "u": "–∫–≥" },
                { "id": "zuk", "name": "–¶—É–∫–∫–∏–Ω–∏ –∑–µ–ª–µ–Ω—ã–µ", "u": "–∫–≥" }
            ]}
        }},
        "grn": { "name": "–ó–µ–ª–µ–Ω—å", "icon": "üåø", "subs": {
            "spicy": { "name": "–ü—Ä—è–Ω—ã–µ —Ç—Ä–∞–≤—ã", "items": [
                { "id": "baz_pot", "name": "–ë–∞–∑–∏–ª–∏–∫ –≤ –≥–æ—Ä—à–æ—á–∫–µ", "u": "—à—Ç" },
                { "id": "baz_gr_iz", "name": "–ë–∞–∑–∏–ª–∏–∫ –∑–µ–ª–µ–Ω—ã–π", "u": "–∫–≥" },
                { "id": "baz_rd", "name": "–ë–∞–∑–∏–ª–∏–∫ –∫—Ä–∞—Å–Ω—ã–π", "u": "–∫–≥" },
                { "id": "kerv", "name": "–ö–µ—Ä–≤–µ–ª—å", "u": "–∫–≥" },
                { "id": "kinza", "name": "–ö–∏–Ω–∑–∞", "u": "–∫–≥" },
                { "id": "myata", "name": "–ú—è—Ç–∞ —Å–≤–µ–∂–∞—è", "u": "–∫–≥" },
                { "id": "petr", "name": "–ü–µ—Ç—Ä—É—à–∫–∞", "u": "–∫–≥" },
                { "id": "petr_kud", "name": "–ü–µ—Ç—Ä—É—à–∫–∞ –∫—É–¥—Ä—è–≤–∞—è", "u": "–∫–≥" },
                { "id": "rozm", "name": "–†–æ–∑–º–∞—Ä–∏–Ω", "u": "–∫–≥" },
                { "id": "tim", "name": "–¢–∏–º—å—è–Ω", "u": "–∫–≥" },
                { "id": "ukr", "name": "–£–∫—Ä–æ–ø", "u": "–∫–≥" },
                { "id": "shal", "name": "–®–∞–ª—Ñ–µ–π", "u": "–∫–≥" },
                { "id": "estr", "name": "–≠—Å—Ç—Ä–∞–≥–æ–Ω", "u": "–∫–≥" }
            ]},
            "lettuce": { "name": "–°–∞–ª–∞—Ç—ã", "items": [
                { "id": "mang_gr", "name": "–ú–∞–Ω–≥–æ–ª—å–¥ –∑–µ–ª–µ–Ω—ã–π (125–≥)", "u": "—É–ø" },
                { "id": "mang_rd", "name": "–ú–∞–Ω–≥–æ–ª—å–¥ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π", "u": "—É–ø" },
                { "id": "mix_sal", "name": "–ú–∏–∫—Å —Å–∞–ª–∞—Ç", "u": "–∫–≥" },
                { "id": "min_spin", "name": "–ú–∏–Ω–∏ —à–ø–∏–Ω–∞—Ç (125–≥)", "u": "—É–ø" },
                { "id": "rost_soi", "name": "–†–æ—Å—Ç–∫–∏ —Å–æ–∏", "u": "–∫–≥" },
                { "id": "sal_ice", "name": "–°–∞–ª–∞—Ç –ê–π—Å–±–µ—Ä–≥", "u": "–∫–≥" },
                { "id": "sal_corn", "name": "–°–∞–ª–∞—Ç –∫–æ—Ä–Ω (125–≥)", "u": "—É–ø" },
                { "id": "sal_lat", "name": "–°–∞–ª–∞—Ç –ª–∞—Ç—É–∫", "u": "–∫–≥" },
                { "id": "sal_lol", "name": "–°–∞–ª–∞—Ç –õ–æ–ª–ª–æ –†–æ—Å—Å–æ", "u": "–∫–≥" },
                { "id": "sal_pak", "name": "–°–∞–ª–∞—Ç –ü–∞–∫ –ß–æ–π", "u": "–∫–≥" },
                { "id": "sal_pak_min", "name": "–°–∞–ª–∞—Ç –ü–∞–∫ –ß–æ–π –º–∏–Ω–∏", "u": "–∫–≥" },
                { "id": "sal_rad", "name": "–°–∞–ª–∞—Ç –†–∞–¥–∏—á–∏–æ", "u": "–∫–≥" },
                { "id": "sal_rom", "name": "–°–∞–ª–∞—Ç –†–æ–º–∞–Ω–æ", "u": "–∫–≥" },
                { "id": "sal_rom_min", "name": "–°–∞–ª–∞—Ç –†–æ–º–∞–Ω–æ –º–∏–Ω–∏", "u": "–∫–≥" },
                { "id": "sal_ruk", "name": "–†—É–∫–∫–æ–ª–∞ –≤–µ—Å", "u": "–∫–≥" },
                { "id": "sal_ruk_lux", "name": "–†—É–∫–∫–æ–ª–∞ –õ—é–∫—Å (125–≥)", "u": "—É–ø" },
                { "id": "sal_fri", "name": "–°–∞–ª–∞—Ç –§—Ä–∏–∑–µ", "u": "–∫–≥" },
                { "id": "sal_fril", "name": "–°–∞–ª–∞—Ç –§—Ä–∏–ª–ª–∏—Å", "u": "–∫–≥" },
                { "id": "sal_mos", "name": "–°–∞–ª–∞—Ç –º–æ—Å–∫–æ–≤—Å–∫–∏–π", "u": "–∫–≥" },
                { "id": "sats", "name": "–°–∞—Ü–∏–º–∞—Ç–∏", "u": "–∫–≥" },
                { "id": "spin", "name": "–®–ø–∏–Ω–∞—Ç", "u": "–∫–≥" },
                { "id": "shav", "name": "–©–∞–≤–µ–ª—å", "u": "–∫–≥" }
            ]},
            "micro": { "name": "–ú–∏–∫—Ä–æ–∑–µ–ª–µ–Ω—å (—É–ø)", "items": [
                { "id": "mic_an", "name": "–ê–Ω—é—Ç–∏–Ω—ã –≥–ª–∞–∑–∫–∏", "u": "—É–ø" },
                { "id": "mic_baz", "name": "–ë–∞–∑–∏–ª–∏–∫ –∑–µ–ª–µ–Ω—ã–π", "u": "—É–ø" },
                { "id": "mic_vas", "name": "–í–∞—Å–∏–ª–µ–∫", "u": "—É–ø" },
                { "id": "mic_gor", "name": "–ì–æ—Ä–æ—Ö", "u": "—É–ø" },
                { "id": "mic_kis", "name": "–ö–∏—Å–ª–∏—Ü–∞", "u": "—É–ø" },
                { "id": "mic_kor", "name": "–ö–æ—Ä–∏–∞–Ω–¥—Ä", "u": "—É–ø" },
                { "id": "mic_mel", "name": "–ú–µ–ª–∏—Å—Å–∞", "u": "—É–ø" },
                { "id": "mic_shav", "name": "–©–∞–≤–µ–ª—å", "u": "—É–ø" }
            ]},
            "exotic_grn": { "name": "–≠–∫–∑–æ—Ç–∏–∫–∞", "items": [
                { "id": "lemon", "name": "–õ–µ–º–æ–Ω–≥—Ä–∞—Å—Å", "u": "–∫–≥" },
                { "id": "list_bam", "name": "–õ–∏—Å—Ç –±–∞–º–±—É–∫–∞", "u": "–∫–≥" },
                { "id": "list_ban", "name": "–õ–∏—Å—Ç –±–∞–Ω–∞–Ω–∞", "u": "–∫–≥" },
                { "id": "list_lime", "name": "–õ–∏—Å—Ç –ª–∞–π–º–∞ (100–≥)", "u": "—É–ø" },
                { "id": "list_svek", "name": "–õ–∏—Å—Ç —Å–≤–µ–∫–ª—ã", "u": "–∫–≥" },
                { "id": "list_seld", "name": "–õ–∏—Å—Ç—å—è —Å–µ–ª—å–¥–µ—Ä–µ—è", "u": "–∫–≥" }
            ]}
        }},
        "fru": { "name": "–§—Ä—É–∫—Ç—ã", "icon": "üçé", "subs": {
            "citrus": { "name": "–¶–∏—Ç—Ä—É—Å–æ–≤—ã–µ", "items": [
                { "id": "apel", "name": "–ê–ø–µ–ª—å—Å–∏–Ω", "u": "–∫–≥" },
                { "id": "apel_soc", "name": "–ê–ø–µ–ª—å—Å–∏–Ω –¥–ª—è —Å–æ–∫–∞", "u": "–∫–≥" },
                { "id": "apel_red", "name": "–ê–ø–µ–ª—å—Å–∏–Ω –∫—Ä–∞—Å–Ω—ã–π", "u": "–∫–≥" },
                { "id": "grape", "name": "–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç", "u": "–∫–≥" },
                { "id": "kum", "name": "–ö—É–º–∫–≤–∞—Ç", "u": "–∫–≥" },
                { "id": "lime", "name": "–õ–∞–π–º", "u": "–∫–≥" },
                { "id": "limon", "name": "–õ–∏–º–æ–Ω", "u": "–∫–≥" },
                { "id": "lim_uzb", "name": "–õ–∏–º–æ–Ω –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", "u": "–∫–≥" },
                { "id": "mand_abh", "name": "–ú–∞–Ω–¥–∞—Ä–∏–Ω –ê–±—Ö–∞–∑–∏—è", "u": "–∫–≥" },
                { "id": "mand", "name": "–ú–∞–Ω–¥–∞—Ä–∏–Ω", "u": "–∫–≥" },
                { "id": "mand_vet", "name": "–ú–∞–Ω–¥–∞—Ä–∏–Ω—ã –Ω–∞ –≤–µ—Ç–æ—á–∫–µ", "u": "–∫–≥" },
                { "id": "pomelo", "name": "–ü–æ–º–µ–ª–æ", "u": "–∫–≥" }
            ]},
            "exotic": { "name": "–≠–∫–∑–æ—Ç–∏–∫–∞", "items": [
                { "id": "avo", "name": "–ê–≤–æ–∫–∞–¥–æ", "u": "–∫–≥" },
                { "id": "avo_has", "name": "–ê–≤–æ–∫–∞–¥–æ –•–∞—Å—Å", "u": "–∫–≥" },
                { "id": "avo_rou", "name": "–ê–≤–æ–∫–∞–¥–æ –∫—Ä—É–≥–ª—ã–π", "u": "–∫–≥" },
                { "id": "anan", "name": "–ê–Ω–∞–Ω–∞—Å –ì–æ–ª–¥", "u": "–∫–≥" },
                { "id": "anan_prem", "name": "–ê–Ω–∞–Ω–∞—Å –ø—Ä–µ–º–∏—É–º", "u": "–∫–≥" },
                { "id": "banan", "name": "–ë–∞–Ω–∞–Ω", "u": "–∫–≥" },
                { "id": "kiwi", "name": "–ö–∏–≤–∏", "u": "–∫–≥" },
                { "id": "kiwi_gold", "name": "–ö–∏–≤–∏ –ì–æ–ª–¥", "u": "–∫–≥" },
                { "id": "mango_per", "name": "–ú–∞–Ω–≥–æ –ø—Ä–µ–º–∏—É–º –ü–µ—Ä—É", "u": "–∫–≥" },
                { "id": "mango_eg", "name": "–ú–∞–Ω–≥–æ –ï–≥–∏–ø–µ—Ç", "u": "–∫–≥" },
                { "id": "mara", "name": "–ú–∞—Ä–∞–∫—É–π—è", "u": "–∫–≥" },
                { "id": "papa", "name": "–ü–∞–ø–∞–π—è", "u": "–∫–≥" },
                { "id": "pita_red", "name": "–ü–∏—Ç–∞—Ö–∞–π—è –∫—Ä–∞—Å–Ω–∞—è", "u": "–∫–≥" },
                { "id": "pita_wh", "name": "–ü–∏—Ç–∞—Ö–∞–π—è –±–µ–ª–∞—è", "u": "–∫–≥" },
                { "id": "fei", "name": "–§–µ–π—Ö–æ–∞", "u": "–∫–≥" },
                { "id": "hurma", "name": "–•—É—Ä–º–∞", "u": "–∫–≥" },
                { "id": "hurma_isp", "name": "–•—É—Ä–º–∞ –ò—Å–ø–∞–Ω–∏—è", "u": "–∫–≥" }
            ]},
            "classic": { "name": "–ö–ª–∞—Å—Å–∏–∫–∞", "items": [
                { "id": "aiva", "name": "–ê–π–≤–∞", "u": "–∫–≥" },
                { "id": "vin_wh", "name": "–í–∏–Ω–æ–≥—Ä–∞–¥ –±–µ–ª—ã–π –±/–∫", "u": "–∫–≥" },
                { "id": "vin_rd", "name": "–í–∏–Ω–æ–≥—Ä–∞–¥ –∫—Ä–∞—Å–Ω—ã–π –±/–∫", "u": "–∫–≥" },
                { "id": "vin_gr_ch", "name": "–í–∏–Ω–æ–≥—Ä–∞–¥ –ó–µ–ª–µ–Ω—ã–π", "u": "–∫–≥" },
                { "id": "gran", "name": "–ì—Ä–∞–Ω–∞—Ç", "u": "–∫–≥" },
                { "id": "gran_soc", "name": "–ì—Ä–∞–Ω–∞—Ç —Å–æ–∫–æ–≤—ã–π", "u": "–∫–≥" },
                { "id": "gru_con", "name": "–ì—Ä—É—à–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è", "u": "–∫–≥" },
                { "id": "gru_for", "name": "–ì—Ä—É—à–∞ –§–æ—Ä–µ–ª—å", "u": "–∫–≥" },
                { "id": "gru_chi", "name": "–ì—Ä—É—à–∞ –∫–∏—Ç–∞–π—Å–∫–∞—è", "u": "–∫–≥" },
                { "id": "sliva", "name": "–°–ª–∏–≤–∞ —á–µ—Ä–Ω–∞—è", "u": "–∫–≥" },
                { "id": "yab_gol", "name": "–Ø–±–ª–æ–∫–∏ –ì–æ–ª–¥–µ–Ω", "u": "–∫–≥" },
                { "id": "yab_gre", "name": "–Ø–±–ª–æ–∫–∏ –ì—Ä–µ–Ω–Ω–∏ –°–º–∏—Ç", "u": "–∫–≥" },
                { "id": "yab_red", "name": "–Ø–±–ª–æ–∫–∏ –ê–π–¥–∞—Ä–µ–¥", "u": "–∫–≥" },
                { "id": "yab_sem", "name": "–Ø–±–ª–æ–∫–∏ –°–µ–º–µ—Ä–µ–Ω–∫–æ", "u": "–∫–≥" }
            ]}
        }},
        "ber": { "name": "–Ø–≥–æ–¥—ã", "icon": "üçì", "subs": {
            "all": { "name": "–í—Å–µ —è–≥–æ–¥—ã", "items": [
                { "id": "golub", "name": "–ì–æ–ª—É–±–∏–∫–∞", "u": "–∫–≥" },
                { "id": "eje", "name": "–ï–∂–µ–≤–∏–∫–∞", "u": "–∫–≥" },
                { "id": "klub", "name": "–ö–ª—É–±–Ω–∏–∫–∞", "u": "–∫–≥" },
                { "id": "malina", "name": "–ú–∞–ª–∏–Ω–∞", "u": "–∫–≥" },
                { "id": "smor", "name": "–°–º–æ—Ä–æ–¥–∏–Ω–∞ –∫—Ä–∞—Å–Ω–∞—è", "u": "–∫–≥" },
                { "id": "fiz", "name": "–§–∏–∑–∞–ª–∏—Å", "u": "—à—Ç" }
            ]}
        }},
        "mus": { "name": "–ì—Ä–∏–±—ã", "icon": "üçÑ", "subs": {
            "all": { "name": "–í—Å–µ –≥—Ä–∏–±—ã", "items": [
                { "id": "vesh", "name": "–í–µ—à–µ–Ω–∫–∏", "u": "–∫–≥" },
                { "id": "shamp", "name": "–®–∞–º–ø–∏–Ω—å–æ–Ω—ã", "u": "–∫–≥" },
                { "id": "shiit", "name": "–ì—Ä–∏–±—ã –®–∏–∏—Ç–∞–∫–∏", "u": "–∫–≥" },
                { "id": "shim", "name": "–ì—Ä–∏–±—ã –®–∏–º–∏–¥–∂–∏ (150–≥)", "u": "—à—Ç" }
            ]}
        }}
    };

    let cart = {}, comments = {};
    let allItems = [], fuse, curItem = null;

    function init() {
        Object.keys(DB).forEach(k => {
            const cat = DB[k];
            if(cat.subs) Object.values(cat.subs).forEach(s => s.items.forEach(i => allItems.push({...i, cat:k})));
        });
        fuse = new Fuse(allItems, { keys:['name'], threshold:0.3 });

        renderAccordion();
        setupSearch();
    }

    function renderAccordion() {
        const c = document.getElementById('accordionView');
        c.innerHTML = '';

        Object.keys(DB).forEach(catKey => {
            const cat = DB[catKey];
            const div = document.createElement('div');
            div.className = 'cat-card';

            div.innerHTML = `
                <div class="cat-header" onclick="toggleCat(this)">
                    <div style="display:flex; align-items:center;">
                        <span class="cat-icon">${cat.icon}</span>${cat.name}
                    </div>
                    <div class="arrow">‚ñº</div>
                </div>
                <div class="sub-container"></div>
            `;
            c.appendChild(div);

            const subCont = div.querySelector('.sub-container');
            if(cat.subs) {
                Object.keys(cat.subs).forEach(subKey => {
                    const sub = cat.subs[subKey];
                    const isSingle = Object.keys(cat.subs).length === 1 && subKey === 'all';

                    if(isSingle) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'item-list-wrap visible'; // Always visible if single
                        wrapper.id = `list-${catKey}-${subKey}`;
                        wrapper.style.maxHeight = 'none'; // No anim for static list
                        subCont.appendChild(wrapper);
                        // Add items immediately
                        sub.items.forEach(item => wrapper.appendChild(createItemRow(item)));
                    } else {
                        const group = document.createElement('div');
                        group.innerHTML = `
                            <div class="sub-header" onclick="toggleSub(this)">
                                <span>${sub.name}</span>
                                <span class="sub-arrow">‚ñº</span>
                            </div>
                            <div class="item-list-wrap" id="list-${catKey}-${subKey}"></div>
                        `;
                        subCont.appendChild(group);
                        const listEl = group.querySelector(`#list-${catKey}-${subKey}`);
                        sub.items.forEach(item => listEl.appendChild(createItemRow(item)));
                    }
                });
            }
        });
    }

    function toggleCat(header) {
        const cont = header.nextElementSibling;
        header.classList.toggle('expanded');
        cont.classList.toggle('visible');
    }

    function toggleSub(header) {
        const list = header.nextElementSibling;
        header.classList.toggle('expanded');
        list.classList.toggle('visible');
    }

    function createItemRow(i) {
        const div = document.createElement('div');
        div.className = 'item-row';
        div.id = `row-${i.id}`;
        div.innerHTML = renderItemContent(i);
        return div;
    }

    function renderItemContent(i) {
        const q = cart[i.id] || 0;
        const hasCom = comments[i.id];

        let controls = '';

        if (q === 0) {
            controls = `<button class="btn-add" onclick="addItem('${i.id}')">–î–æ–±–∞–≤–∏—Ç—å</button>`;
        } else {
            controls = `
                <div class="counter-wrap">
                    <button class="btn-comment ${hasCom?'active':''}" onclick="openComment('${i.id}')">üí¨</button>
                    <button class="btn-mini minus" onclick="changeQty('${i.id}', -1)">‚àí</button>
                    <div class="val-display" onclick="openInput('${i.id}')">${q}</div>
                    <button class="btn-mini plus" onclick="changeQty('${i.id}', 1)">+</button>
                </div>
            `;
        }

        return `
            <div class="item-name">${i.name}</div>
            <div>${controls}</div>
        `;
    }

    // ACTIONS
    window.addItem = (id) => { cart[id] = 1; refreshItem(id); }
    window.changeQty = (id, delta) => {
        const curr = cart[id] || 0;
        const next = curr + delta;
        if(next <= 0) { delete cart[id]; delete comments[id]; } 
        else cart[id] = next;
        refreshItem(id);
    }

    function refreshItem(id) {
        const item = allItems.find(x => x.id == id);
        const row = document.getElementById(`row-${id}`);
        if(row) row.innerHTML = renderItemContent(item);
        const sRow = document.getElementById(`search-row-${id}`);
        if(sRow) sRow.innerHTML = renderItemContent(item);
        updateCartBar();
    }

    function updateCartBar() {
        const count = Object.keys(cart).length;
        const bar = document.getElementById('cartBar');
        document.getElementById('cartCount').innerText = `${count} –ø–æ–∑.`;

        if(count > 0) bar.classList.add('visible'); 
        else bar.classList.remove('visible');
    }

    window.openInput = (id) => {
        curItem = id;
        const i = allItems.find(x => x.id == id);
        document.getElementById('inputName').innerText = `${i.name} (${i.u})`;
        document.getElementById('sysInput').value = cart[id];
        openModal('inputModal');
        setTimeout(()=>document.getElementById('sysInput').focus(),100);
    }

    window.saveInput = () => {
        const val = parseFloat(document.getElementById('sysInput').value);
        if(val > 0) cart[curItem] = val;
        else { delete cart[curItem]; delete comments[curItem]; }
        refreshItem(curItem); closeModal('inputModal');
    }

    window.openComment = (id) => {
        curItem = id;
        document.getElementById('comText').value = comments[id] || '';
        openModal('commentModal');
        setTimeout(()=>document.getElementById('comText').focus(),100);
    }

    window.saveComment = () => {
        const val = document.getElementById('comText').value.trim();
        if(val) comments[curItem] = val; else delete comments[curItem];
        refreshItem(curItem); closeModal('commentModal');
    }

    // ORDER
    window.openOrderModal = () => {
        const list = document.getElementById('orderList');
        list.innerHTML = '';
        allItems.forEach(i => {
            if(cart[i.id]) {
                const row = document.createElement('div');
                row.style.padding = '8px 0';
                row.style.borderBottom = '1px solid #333';
                row.style.display = 'flex'; row.style.justifyContent='space-between';

                let comHtml = comments[i.id] ? `<div style="color:#0a84ff; font-size:12px;">üí¨ ${comments[i.id]}</div>` : '';

                row.innerHTML = `
                    <div style="flex:1; padding-right:10px;">
                        <div style="font-size:14px;">${i.name}</div>
                        ${comHtml}
                    </div>
                    <div style="font-size:14px; font-weight:700;">${cart[i.id]} ${i.u}</div>
                `;
                list.appendChild(row);
            }
        });
        openModal('orderModal');
    }

    window.sendOrder = () => {
        const data = { cart, comments, global: document.getElementById('globalCom').value };
        tg.sendData(JSON.stringify(data));
    }

    // SEARCH
    function setupSearch() {
        const inp = document.getElementById('search');
        const resDiv = document.getElementById('searchResults');
        const accDiv = document.getElementById('accordionView');

        inp.addEventListener('input', (e) => {
            const val = e.target.value.trim();
            if(val.length < 2) {
                resDiv.classList.add('hidden'); accDiv.classList.remove('hidden'); return;
            }
            accDiv.classList.add('hidden'); resDiv.classList.remove('hidden');

            const res = fuse.search(val);
            resDiv.innerHTML = '';
            if(res.length===0) { resDiv.innerHTML = '<div style="text-align:center; padding:20px; color:#666; font-size:13px;">–ü—É—Å—Ç–æ</div>'; return; }

            res.forEach(r => {
                const d = document.createElement('div');
                d.className = 'item-row';
                d.id = `search-row-${r.item.id}`;
                d.style.borderBottom = '1px solid #333';
                d.innerHTML = renderItemContent(r.item);
                resDiv.appendChild(d);
            });
        });
    }

    window.openModal = (id) => document.getElementById(id).classList.add('visible');
    window.closeModal = (id) => document.getElementById(id).classList.remove('visible');

    init();
</script>
</body>
</html>
